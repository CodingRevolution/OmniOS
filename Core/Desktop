--Variables--
os.loadAPI("TheOS/API/paint")
args = {...}
local currWindow = 1
local Settings = {}
local Shortcuts = {}
local textutilsserialize = textutils.serialize
local textutilsunserialize = textutils.unserialize
term.redirect(term.native())
print(textutilsserialize(args))
--Functions--
local function loadShortcut(x)
	local m = fs.open("TheOS/Desktop/"..tostring(x)..".shortcuts","r")
	Shortcuts = textutilsunserialize(m.readAll())
	m.close()
end

local function loadSettings()
	local n = fs.open("TheOS/Desktop/Settings","r")
	Settings = textutilsunserialize(n.readAll())
	n.close()
end


local function drawShortcuts(t)
	for i,v in pairs(t) do
		local xPos = (v[1]-1)*9+2 
		local yPos = (v[2]-1)*7+2
		local image = {}
		local f = fs.open(v[3]..".ico","r")
		image = textutilsunserialize(f.readAll())
		f.close()
		paint.betterPaint(xPos,yPos,image[1],image[2])
	end
end

--Code--
--Load Settings
loadSettings()

--Load Shortcuts--
loadShortcut(currWindow)

--Code--
term.setBackgroundColor(colors.cyan)
term.setTextColor(colors.black)
term.clear()
term.setCursorPos(1,1)
print(fs.exists("TheOS/Desktop/Settings"))
print(textutilsserialize(Settings))
print("meh")
print(args[1])
os.pullEvent()
term.clear()
term.setCursorPos(1,1)
print("drawing shortcuts")
l = fs.open("r","w")
for i,v in pairs(_G) do
	l.writeLine(i)
end
l.close()
drawShortcuts(Shortcuts)
os.pullEvent()