--Variables--
args = {...}
local currWindow = 1
local Settings = {}
local Shortcuts = {}
local textutilsserialize = textutils.serialize
local textutilsunserialize = textutils.unserialize
term.redirect(term.native())
print(textutilsserialize(args))
--Functions--
local function loadShortcut(x)
	local m = fs.open("TheOS/Desktop/"..tostring(x)..".shortcuts","r")
	Shortcuts = textutilsunserialize(m.readAll())
	m.close()
end

local function loadSettings()
	local n = fs.open("TheOS/Desktop/Settings","r")
	Settings = textutilsunserialize(n.readAll())
	n.close()
end


local function drawShortcuts(t)
	for i,v in pairs(t) do
		local xPos = (v[1]-1)*9+2 
		local yPos = (v[2]-1)*7+2
		term.setCursorPos(xPos,yPos)
		local image = {}
		local f = fs.open(v[3]..".ico","r")
		image = textutilsunserialize(f.readAll())
		f.close()
		paintutils.drawImage(image[1],xPos,yPos)
		
		term.setBackgroundColor(colors.cyan)
		term.setTextColor(colors.black)
		local buffer = {}
		for token in string.gmatch(image[2],"[^%s]") do
			buffer[#buffer+1] = token
		end
		for i,v in pairs(buffer) do
			if string.sub(v,1,1) == "<" then
				local toAnalize = string.sub(v,2,-2)
				print(toAnalize)
			else
				--term.write(v)
			end
		end
	end
end

--Code--
--Load Settings
loadSettings()

--Load Shortcuts--
loadShortcut(currWindow)

--Code--
term.setBackgroundColor(colors.cyan)
term.setTextColor(colors.black)
term.clear()
term.setCursorPos(1,1)
print(fs.exists("TheOS/Desktop/Settings"))
print(textutilsserialize(Settings))
print("meh")
print(args[1])
os.pullEvent()
term.clear()
drawShortcuts(Shortcuts)
error()
os.pullEvent()
error()